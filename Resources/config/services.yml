services:
    # Twig extension
    twig.extension.vince.cms_sonata_admin:
        class: Vince\Bundle\CmsSonataAdminBundle\Twig\Extension\CmsSonataAdminExtension
        tags:
            - { name: twig.extension }

    # Admin class
    vince.admin.publishable:
        class: Vince\Bundle\CmsSonataAdminBundle\Admin\PublishableAdmin
        abstract: true
        calls:
            - [ setTranslationDomain, [ 'SonataAdminBundle' ] ]

    vince.admin.translatable:
        class: Vince\Bundle\CmsSonataAdminBundle\Admin\TranslatableAdmin
        abstract: true
        parent: vince.admin.publishable
        calls:
            - [ setDefaultLocale, [ %vince.cms.defaultLocale% ] ]
            - [ setLocales, [ %vince.cms.locales% ] ]
            - [ setObjectManager, [ @doctrine.orm.default_entity_manager ] ]
            - [ setTranslationRepository, [ @gedmo.repository.translation ] ]

    vince.admin.article:
        class: %vince.admin.article.class%
        parent: vince.admin.translatable
        tags:
            - name: sonata.admin
              manager_type: orm
              group: cms
              label_catalogue: SonataAdminBundle
              label: Articles
        arguments: [ ~, %vince.class.article%, VinceCmsSonataAdminBundle:Article ]
        calls:
            - [ setMetaRepository, [ @vince.repository.meta ] ]
            - [ setUser, [ @security.context ] ]
            - [ setObjectManager, [ @doctrine.orm.default_entity_manager ] ]
            - [ setCacheDir, [ %kernel.cache_dir% ] ]
            - [ setArticleMetaClass, [ %vince.class.articlemeta% ] ]

    vince.admin.block:
        class: %vince.admin.block.class%
        parent: vince.admin.translatable
        tags:
            - name: sonata.admin
              manager_type: orm
              group: cms
              label_catalogue: SonataAdminBundle
              label: Blocs
        arguments: [ ~, %vince.class.block%, VinceCmsSonataAdminBundle:Translatable ]
        calls:
            - [ setTranslationDomain, [ 'SonataAdminBundle' ] ]

    vince.admin.menu:
        class: %vince.admin.menu.class%
        parent: vince.admin.translatable
        tags:
            - name: sonata.admin
              manager_type: orm
              group: cms
              label_catalogue: SonataAdminBundle
              label: Menus
        arguments: [ ~, %vince.class.menu%, VinceCmsSonataAdminBundle:Menu ]
        calls:
            - [ setMenuRepository, [ @vince.repository.menu ] ]
            - [ setUploadDir, [ %kernel.upload_dir%, %kernel.web_dir% ] ]

    # Form types
    form.type_extension.filename:
        class: Vince\Bundle\CmsSonataAdminBundle\Form\Extension\FilenameTypeExtension
        tags:
            - { name: form.type_extension, alias: form }

    form.type.metagroup:
        class: Vince\Bundle\CmsSonataAdminBundle\Form\Type\MetaGroupType
        tags:
            - { name: form.type, alias: metagroup }
        calls:
            - [ setMetaRepository, [ @vince.repository.meta ] ]
            - [ setArticleMetaClassName, [ %vince.class.articleMeta% ] ]

    form.type.meta:
        class: Vince\Bundle\CmsSonataAdminBundle\Form\Type\MetaType
        tags:
            - { name: form.type, alias: meta }

    form.type.template:
        class: Vince\Bundle\CmsSonataAdminBundle\Form\Type\TemplateType
        tags:
            - { name: form.type, alias: template }
        calls:
            - [ setTemplateRepository, [ @vince.repository.template ] ]
            - [ setContentClassName, [ %vince.class.content% ] ]

    form.type.area:
        class: Vince\Bundle\CmsSonataAdminBundle\Form\Type\AreaType
        tags:
            - { name: form.type, alias: area }
